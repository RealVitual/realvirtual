<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title></title>
<!-- 	<link rel="icon" type="image/png" href="/static/web_3/img/favicon/256x256.png"/>
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/web_3/img/favicon/114x114.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/web_3/img/favicon/72x72.png">
    <link rel="apple-touch-icon-precomposed" href="/static/web_3/img/favicon/57x57.png"> -->
    {% block cssadicional %}
    {% endblock %}
    <link rel="stylesheet" type="text/css" href="/static/web_3/css/styles.css?v=1{{ BUILD_ID }}"/>
    <link rel="stylesheet" href="/static/web_3/js/validationform/validationEngine.jquery.css">
    <!-- <link rel="stylesheet" type="text/css" href="/static/web_3/css/blocks_styl.css?v=2{{ BUILD_ID }}"/> -->
</head>


<div class="overlay"></div>
<div class="videoPopupContent">
    <!-- mp4 - youtube - vimeo -->
</div>
<body class="{% block classbody %}{% endblock %}">
    <div class="contentWrapper">
        {% include "landing_3/common/_header.html" %}
        <div class="wrapper">
            {% block content %}{% endblock %}
        </div>
        {% include "landing_3/common/_footer.html" %}
    </div>
    {% if company.contact_phone %}
        <a target="_blank" href="https://wa.me/{{company.contact_phone}}" class="icon-whatsapp wspFixed"></a>
    {% endif %}
    <!-- <a href="#" class="openSidebarMobile icon-menu"></a> -->
    <!-- <div class="sidebarContentMobile"></div> -->
    <!-- <script src="/static/web_3/js/jquery-3.2.1.min.js" type="text/javascript"></script> -->
    <script src="/static/web_3/js/jquery-3.7.1.min.js" type="text/javascript"></script>
    <script src="/static/web_3/js/main.js" type="text/javascript"></script>
    <script src="/static/web_3/js/validationform/jquery.validationEngine.js"></script>

    {% if company.cookies_policy %}
    <div class="coockies" id="elCoockie">
        <div class="grilla">
            <div class="gParrafo">
                <p>Este sitio web utiliza cookies necesarias para su funcionamiento. Antes de continuar navegando, te sugerimos revisar el tratamiento de estas en nuestra <a target="_blank" href="{{company.cookies_policy.url}}">Política de Cookies</a></p>
            </div>
            <a href="#" class="gButton " id="buttonCookie">Cerrar</a>
        </div>
    </div>
    {% endif %}

    <!-- <a href="" class="empresafx">
        <img src="/static/web_3/img/logocallirgos.jpeg" alt="">
    </a> -->
    {% if company.warning_img%}
    <div class="popUpInfo">
        <a href="" class="icon-close cerrarPopup"></a>
        <figure>
            <img src="{{company.warning_img.url}}" alt="">
        </figure>
    </div>
    {% endif %}


    <!-- JSADD START -->
    {% block jsfinal %}{% endblock %}
    <!-- JSADD END -->
    <script>
        'use strict';
        var register_data = "";
        document.addEventListener('DOMContentLoaded', function() {
            const buttonCookie = document.getElementById('buttonCookie');
            const elCoockie = document.getElementById('elCoockie');

            if (localStorage.getItem('ocultarElemento') === 'true') {
                elCoockie.style.display = 'none';
            }

            buttonCookie.addEventListener('click', function() {
                elCoockie.style.display = 'none';
                localStorage.setItem('ocultarElemento', 'true');
            });
        });
        $(function(){
            //Configuraciòn general de plugin formulario
            $("form").validationEngine('attach', {
                promptPosition : "topLeft",
                autoHidePrompt: true,
                autoHideDelay: 2000,
                binded: false,
                scroll: false,
                validateNonVisibleFields: true
            });

            //Evento form LOGIN
            $('.g8SumitLogin').click(function(e){
                e.preventDefault();
                var item = $(this);
                var valid = item.closest('form').validationEngine('validate');
                var form = $(this).closest('form');
                if (!valid) {

                    } else {
                }
            });
            //Evento form REGISTRO
            $('.g8SumitRegistro').click(function(e){
                e.preventDefault();
                var item = $(this);
                var valid = item.closest('form').validationEngine('validate');
                var form = $(this).closest('form');
                if (!valid) {

                    } else {
                    //En caso de que el registro sea el correcto se activara el popup del mensaje de "registro exitoso"
                    OVERLAY.classList.add('active')
                    document.getElementsByClassName('formRegistroExitoso')[0]?.classList.add('active')
                }
            });
            //Evento form verificación correo electrónico
            $('.g8SubmitCorreoVerificacion').click(function(e){
                e.preventDefault();
                var item = $(this);
                var valid = item.closest('form').validationEngine('validate');
                var form = $(this).closest('form');
                if (!valid) {

                    } else {
                }
            });
            //Evento form actualizar contraseña
            $('.g8SubmitActualizarPassword').click(function(e){
                e.preventDefault();
                var item = $(this);
                var valid = item.closest('form').validationEngine('validate');
                var form = $(this).closest('form');
                if (!valid) {

                    } else {
                }
            });
        })

        let elkeypress = document.getElementsByClassName('validKeypress')
        for(const keypress of elkeypress) {
            keypress.addEventListener('keypress',function(e){
                let getTypeValue = this.dataset.type
                getTypeValue == "number" ? getTypeValue = /\d{1,9}$/g : getTypeValue = /([A-Za-zñÑáéíóúÁÉÍÓÚ\s]+)/;
                let inputCode = e.keyCode || e.charCode;
                if(inputCode!=8 && inputCode!=37 && inputCode!=39 && inputCode!=46){
                    var charStr = String.fromCharCode(inputCode);
                    !getTypeValue.test(charStr) ? event.preventDefault() : console.log("correcto")	
                }
            })
        }
        let elInputBox = document.getElementsByClassName('g8Box')
        for(const inputBox of elInputBox) {
            inputBox.addEventListener('focusin',function() {
                this.parentNode.classList.add('active')
            })
            inputBox.addEventListener('focusout',function() {
                if(this.value === ""){
                    this.parentNode.classList.remove('active')
                }
            })
        }


    document.addEventListener("DOMContentLoaded", function () {
        const popup = document.getElementsByClassName("popUpInfo")[0];
        const cerrarPopup = document.getElementsByClassName("cerrarPopup")[0];

        // Revisa si el popup ya ha sido mostrado anteriormente
        if (!localStorage.getItem("popupShown")) {
            popup.classList.add("active"); // Muestra el popup
            // OVERLAY.classList.add("active");
            OVERLAY.style.zIndex = 1900
        }

        // Evento para cerrar el popup
        cerrarPopup.addEventListener("click", function (e) {
            e.preventDefault();
            popup.classList.remove("active"); // Oculta el popup
            localStorage.setItem("popupShown", "true"); // Guarda en localStorage que el popup ya se mostró
            OVERLAY.classList.remove("active");
        });
    });
    window.dataLayer = window.dataLayer || [];
    $('.g8SumitLogin').click(function(e){
        e.preventDefault();
        var item = $(this);
        var valid = item.closest('form').validationEngine('validate');
        var form = $(this).closest('form');
        if (!valid) {
            } else {
                $('.g8SumitLogin').addClass('isLoading');
                $('.g8SumitLogin').disabled = true;
                let login_data = form.serialize()
                $.ajax({
                    url : "/login_access/",
                    type : "post",
                    data: login_data,
                }).done(function(data) {
                    if(data.success){
                        window.location.href = data.redirect_url
                    }else{
                        $('.g8SumitLogin').disabled = false;
                        var message = $('.message-warning-login')
                        message.html(data.message)
                        message.show();
                        setTimeout(()=>{
                            message.fadeOut('slow')
                        }, 2000)
                        $('.g8SumitLogin').removeClass('isLoading')
                        if(data.captcha_error == 1){
                            setTimeout(()=>{
                                location.reload();
                            }, 3000)
                        }
                    }
                });
        }
    });
    $('.save-register').click(function(e){
        e.preventDefault();
        var item = $(this);
        var valid = item.closest('form').validationEngine('validate');
        var form = $(this).closest('form');
        console.log(form, 'form')
        if (!valid) {
            } else {
                $('.save-register').addClass('isLoading');
                $('.save-register').disabled = true;
                register_data = form.serialize()
                console.log(register_data, 'REGISTER DATA')
                $.ajax({
                    url : "{% url 'landing:validate_register' %}",
                    type : "post",
                    data: register_data,
                }).done(function(data) {
                    if(data.captcha_error == 1){
                        setTimeout(()=>{
                            location.reload();
                        }, 3000)
                    }
                    if(data.success){
                        window.dataLayer.push({
                            'event': 'formulario',
                            'email': register_data['email'],
                            'nombres': register_data['names'],
                            'apellidos': register_data['last_name']
                         });
                        console.log(window.dataLayer, 'DATALAYER')
                        $('.save-register').disabled = false;
                        console.log(data, 'DATA')
                        if(data.confirmed){
                            $('.parrafo-register').show();
                            $('.warning-form').hide();
                            setTimeout(()=>{
                                window.location.href = data.redirect_url
                            }, 2000)
                        }else{
                            var parrafo_register = $('.parrafo-register')
                            parrafo_register.hide();
                            var register_form = $('.register-form')
                            register_form.hide();
                            $('.message-waiting-confirmation').html(data.confirmed_message)
                            $('.waiting-confirmation-form').show();
                            setTimeout(()=>{
                                window.location.href = data.redirect_url
                            }, 20000)
                        }

                    }else{
                        $('.save-register').disabled = false;
                        $('.save-register').removeClass('isLoading');
                        var parrafo_register = $('.parrafo-register')
                        var msg = $('.message-warning')
                        var register_form = $('.register-form')
                        var warning_form = $('.warning-form')
                        register_form.hide();
                        parrafo_register.hide();
                        msg.html(data.message)
                        if(data.can_confirm){
                            $('.confirm-div').show()
                        }
                        else{
                            $('.confirm-div').hide()
                        }
                        warning_form.show();
                    }
                });
        }
    });

    </script>
</body>
</html>
